# Variables
@baseUrl = http://127.0.0.1:8337
@product_iphone = 1
@product_headphones = 2
@product_case = 3

### -------------------------
### NEGATIVE / VALIDATION CASES
### -------------------------

### 1) Invalid tax number
### Expected calculate: 422 Unprocessable Entity
### { "error": "Invalid tax number" }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "INVALID",
  "couponCode": null
}

###
### Expected purchase: 422
### { "error": "Invalid tax number" }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "INVALID",
  "couponCode": null,
  "paymentProcessor": "paypal"
}

### 2) Unknown product
### Expected calculate: 422
### { "error": "Product not found" }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": 999,
  "taxNumber": "DE123456789",
  "couponCode": null
}

###
### Expected purchase: 422
### { "error": "Product not found" }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "product": 999,
  "taxNumber": "DE123456789",
  "couponCode": null,
  "paymentProcessor": "paypal"
}

### 3) Zero product ID
### Expected calculate: 422
### { "errors": { "product": "This value should be positive." } }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": 0,
  "taxNumber": "DE123456789",
  "couponCode": null
}

###
### Expected purchase: 422
### { "errors": { "product": "This value should be positive." } }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "product": 0,
  "taxNumber": "DE123456789",
  "couponCode": null,
  "paymentProcessor": "paypal"
}

### 4) Missing product field
### Expected calculate: 422
### { "errors": { "product": "This value should not be blank." } }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "taxNumber": "DE123456789",
  "couponCode": null
}

###
### Expected purchase: 422
### { "errors": { "product": "This value should not be blank." } }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "taxNumber": "DE123456789",
  "couponCode": null,
  "paymentProcessor": "paypal"
}

### 5) Invalid coupon code
### Expected calculate: 422
### { "error": "Invalid or inactive coupon" }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "DE123456789",
  "couponCode": "INVALID"
}

###
### Expected purchase: 422
### { "error": "Invalid or inactive coupon" }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "DE123456789",
  "couponCode": "INVALID",
  "paymentProcessor": "paypal"
}

### 6) Missing payment processor (only for purchase)
### Expected purchase: 422
### { "errors": { "paymentProcessor": "This value should not be blank." } }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "DE123456789",
  "couponCode": null
}

### 7) Unsupported paymentProcessor
### Expected: 422 (or 400) with error message
### { "error": "Unsupported payment processor" }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "DE123456789",
  "couponCode": null,
  "paymentProcessor": "unknown"
}

### 8) Missing taxNumber
### Expected calculate: 422 validation error
### { "errors": { "taxNumber": "This value should not be blank." } }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "couponCode": null
}

###
### Expected purchase: 422
### { "errors": { "taxNumber": "This value should not be blank." } }
POST {{baseUrl}}/api/purchase
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "couponCode": null,
  "paymentProcessor": "paypal"
}

### 9) Different-country VAT checks (calc only): FR / GR
### Expected FR calculate: 200 { "price": 120.00, "currency": "EUR" }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "FRAB123456789",
  "couponCode": null
}

###
### Expected GR calculate: 200 { "price": 124.00, "currency": "EUR" }
POST {{baseUrl}}/api/calculate-price
Accept: application/json
Content-Type: application/json

{
  "product": {{product_iphone}},
  "taxNumber": "GR123456789",
  "couponCode": null
}
